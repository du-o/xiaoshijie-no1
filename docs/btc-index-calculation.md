# BTC指数计算文档

## 概述
本文档记录BTC购买指数和ahr999指数的计算方法，用于每日定时生成BTC投资参考报告。

---

## 一、ahr999指数

### 1.1 公式
```
ahr999指数 = (当前价格 / 200日定投成本) × (当前价格 / 指数增长估值)
```

### 1.2 各组件计算方式

#### 当前价格
- **数据源**: CoinGecko API
- **接口**: `https://api.coingecko.com/api/v3/coins/bitcoin`
- **字段**: `market_data.current_price.usd`

#### 200日定投成本
- **定义**: 每天投入固定金额（如$1），200天后的平均持仓成本
- **计算公式**: 
  ```
  200日定投成本 = 200 / Σ(1/每日价格)
  ```
- **说明**: 这是调和平均数，不是简单算术平均
- **数据源**: CoinGecko API历史价格
- **接口**: `https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=200`

#### 指数增长估值
- **定义**: 基于币龄的指数拟合估值
- **计算公式**:
  ```
  指数增长估值 = 10^(5.84 × log10(币龄) - 17.01)
  ```
- **币龄计算**:
  - 比特币生日: 2009年1月3日
  - 币龄 = 从2009年1月3日到当天的总天数
- **对数底数**: log10（以10为底的对数）

### 1.3 指数解读

| ahr999值 | 区间 | 操作建议 |
|---------|------|---------|
| < 0.45 | 抄底区间 | 大胆买入 |
| 0.45 - 1.2 | 定投区间 | 分批买入 |
| 1.2 - 5 | 等待起飞 | 持有观望 |
| > 5 | 可能顶部 | 考虑减仓 |

---

## 二、BTC购买指数

### 2.1 指数范围
0-100分，分数越高越推荐买入

### 2.2 计算维度及权重

| 维度 | 权重 | 说明 |
|------|------|------|
| 技术指标 | 40% | RSI、MACD、移动平均线等 |
| 市场情绪 | 30% | 恐惧贪婪指数、新闻情绪 |
| 链上数据 | 20% | 交易所流入流出、鲸鱼动向 |
| 宏观因素 | 10% | 美元指数、美股相关性 |

### 2.3 分数解读

| 分数 | 建议 |
|------|------|
| 0-20 | 强烈不建议买入 |
| 21-40 | 不建议买入 |
| 41-60 | 中性/观望 |
| 61-80 | 建议买入 |
| 81-100 | 强烈建议买入 |

---

## 三、数据源

### 3.1 价格数据
- **CoinGecko API**: https://www.coingecko.com/en/api

### 3.2 恐惧贪婪指数
- **Alternative.me API**: `https://api.alternative.me/fng/`

### 3.3 新闻数据
- CoinDesk: https://www.coindesk.com/
- 其他加密新闻媒体

---

## 四、定时任务

### 4.1 任务配置
- **执行时间**: 每天早上 8:00 (北京时间)
- **时区**: Asia/Shanghai
- **任务类型**: Cron Job
- **执行环境**: Isolated Session

### 4.2 执行步骤
1. 获取BTC当前价格（CoinGecko API）
2. 获取过去200天历史价格数据
3. 计算200日定投成本（定投调和平均）
4. 计算指数增长估值（币龄公式）
5. 计算ahr999指数
6. 获取恐惧贪婪指数
7. 获取最新BTC相关新闻
8. 生成完整报告
9. 推送到Feishu

### 4.3 报告格式
```
📈 BTC指数日报 (YYYY-MM-DD)

💰 当前BTC价格: $XX,XXX

━━━━━━━━━━━━━━━━━━━━━
🎯 ahr999指数: X.XX

200日定投成本: $XX,XXX
指数增长估值: $XX,XXX
评级: [抄底区间/定投区间/等待起飞]

━━━━━━━━━━━━━━━━━━━━━
📊 BTC购买指数: XX/100

【分项得分】
- 价格位置: XX/100
- 趋势动能: XX/100
- 市场情绪: XX/100 (恐惧贪婪指数: XX)
- 宏观环境: XX/100

【支撑新闻】
- 新闻1...
- 新闻2...

【综合建议】
...
```

---

## 五、注意事项

1. **数据精度**: CoinGecko提供的是日终价格，与实际定投成本可能有微小偏差
2. **API限制**: CoinGecko免费API有速率限制，注意控制调用频率
3. **时区处理**: 所有时间统一使用北京时间（Asia/Shanghai）
4. **异常处理**: 如果API获取失败，应有重试机制和错误提示

---

## 六、参考链接

- ahr999指数原文: https://ahr999.com/ahr999/ahr999_buy03.html
- CoinGecko API文档: https://www.coingecko.com/en/api/documentation
- 恐惧贪婪指数: https://alternative.me/crypto/fear-and-greed-index/

---

*文档创建时间: 2026-02-09*
*最后更新: 2026-02-09*
